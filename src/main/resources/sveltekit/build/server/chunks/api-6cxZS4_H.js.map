{"version":3,"file":"api-6cxZS4_H.js","sources":["../../../.svelte-kit/adapter-node/chunks/api.js"],"sourcesContent":["import axios from \"axios\";\nconst accessToken = async () => {\n  localStorage.getItem(\"accessToken\");\n  const storedRefreshToken = localStorage.getItem(\"refreshToken\");\n  if (!storedRefreshToken && window.location.pathname !== \"/\") {\n    alert(\"로그인을 다시 진행해주세요.\");\n    window.location.href = \"http://localhost:5173/\";\n    throw new Error(\"Refresh Token이 없어서 새로운 Access Token을 발급할 수 없습니다.\");\n  }\n  try {\n    const response = await axios.post(\"http://localhost:8080/api/v1/access-token\", null, {\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${storedRefreshToken}`\n      }\n    });\n    if (response.status === 200) {\n      const data = response.data;\n      const newAccessToken = data.data.newAccessToken;\n      localStorage.setItem(\"accessToken\", newAccessToken);\n      return newAccessToken;\n    } else {\n      console.error(\"서버 응답 오류:\", response.statusText);\n      throw new Error(\"Access Token 갱신 중 서버 응답 오류\");\n    }\n  } catch (error) {\n    if (error.response) {\n      console.error(\"Response data:\", error.response.data);\n      console.error(\"Response status:\", error.response.status);\n      console.error(\"Response headers:\", error.response.headers);\n      if (error.response.status === 401 || error.response.status === 403 || error.response.status === 500 && window.location.pathname !== \"/\") {\n        alert(\"로그인이 만료되었습니다. 다시 로그인 해주세요.\");\n        window.location.href = \"http://localhost:5173/\";\n      }\n    } else if (error.request) {\n      console.error(\"Request data:\", error.request);\n    } else {\n      console.error(\"Error message:\", error.message);\n    }\n    console.error(\"Error config:\", error.config);\n    throw new Error(\"Access Token 갱신 중 오류 발생\");\n  }\n};\nconst instance = axios.create({\n  baseURL: \"http://localhost:8080/api/v1/\",\n  timeout: 1e3\n});\ninstance.interceptors.request.use(\n  async (config) => {\n    if (typeof window !== \"undefined\") {\n      const refreshToken = localStorage.getItem(\"refreshToken\");\n      const accessToken2 = localStorage.getItem(\"accessToken\");\n      if (!refreshToken) {\n        return config;\n      }\n      if (accessToken2) {\n        config.headers[\"Content-Type\"] = \"application/json\";\n        config.headers[\"Authorization\"] = `Bearer ${accessToken2}`;\n      } else {\n        console.error(\"No access token found\");\n      }\n    }\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);\ninstance.interceptors.response.use(\n  async (response) => {\n    if (response.status === 200) {\n      response = response.data;\n      const username = response.data.username;\n      return username;\n    }\n    if (response.status === 404) ;\n    return response;\n  },\n  async (error) => {\n    if (typeof window !== \"undefined\") {\n      if (error.response?.status === 401 || error.response?.status === 500) {\n        const newAccessToken = await accessToken();\n        window.location.reload();\n        if (newAccessToken) {\n          localStorage.setItem(\"accessToken\", newAccessToken);\n          error.config.headers[\"Authorization\"] = `Bearer ${newAccessToken}`;\n          return axios.request(error.config);\n        }\n      }\n    }\n    return Promise.reject(error);\n  }\n);\nexport {\n  instance as i\n};\n"],"names":[],"mappings":";;AACA,MAAM,WAAW,GAAG,YAAY;AAChC,EAAE,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;AACtC,EAAE,MAAM,kBAAkB,GAAG,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;AAClE,EAAE,IAAI,CAAC,kBAAkB,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ,KAAK,GAAG,EAAE;AAC/D,IAAI,KAAK,CAAC,iBAAiB,CAAC,CAAC;AAC7B,IAAI,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,wBAAwB,CAAC;AACpD,IAAI,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;AACxE,GAAG;AACH,EAAE,IAAI;AACN,IAAI,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,IAAI,CAAC,2CAA2C,EAAE,IAAI,EAAE;AACzF,MAAM,OAAO,EAAE;AACf,QAAQ,cAAc,EAAE,kBAAkB;AAC1C,QAAQ,aAAa,EAAE,CAAC,OAAO,EAAE,kBAAkB,CAAC,CAAC;AACrD,OAAO;AACP,KAAK,CAAC,CAAC;AACP,IAAI,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AACjC,MAAM,MAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC;AACjC,MAAM,MAAM,cAAc,GAAG,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC;AACtD,MAAM,YAAY,CAAC,OAAO,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;AAC1D,MAAM,OAAO,cAAc,CAAC;AAC5B,KAAK,MAAM;AACX,MAAM,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,QAAQ,CAAC,UAAU,CAAC,CAAC;AACtD,MAAM,MAAM,IAAI,KAAK,CAAC,4BAA4B,CAAC,CAAC;AACpD,KAAK;AACL,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,IAAI,KAAK,CAAC,QAAQ,EAAE;AACxB,MAAM,OAAO,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;AAC3D,MAAM,OAAO,CAAC,KAAK,CAAC,kBAAkB,EAAE,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;AAC/D,MAAM,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACjE,MAAM,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,QAAQ,CAAC,MAAM,KAAK,GAAG,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ,KAAK,GAAG,EAAE;AAC/I,QAAQ,KAAK,CAAC,4BAA4B,CAAC,CAAC;AAC5C,QAAQ,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,wBAAwB,CAAC;AACxD,OAAO;AACP,KAAK,MAAM,IAAI,KAAK,CAAC,OAAO,EAAE;AAC9B,MAAM,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AACpD,KAAK,MAAM;AACX,MAAM,OAAO,CAAC,KAAK,CAAC,gBAAgB,EAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AACrD,KAAK;AACL,IAAI,OAAO,CAAC,KAAK,CAAC,eAAe,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC;AACjD,IAAI,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;AAC/C,GAAG;AACH,CAAC,CAAC;AACG,MAAC,QAAQ,GAAG,KAAK,CAAC,MAAM,CAAC;AAC9B,EAAE,OAAO,EAAE,+BAA+B;AAC1C,EAAE,OAAO,EAAE,GAAG;AACd,CAAC,EAAE;AACH,QAAQ,CAAC,YAAY,CAAC,OAAO,CAAC,GAAG;AACjC,EAAE,OAAO,MAAM,KAAK;AACpB,IAAI,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;AACvC,MAAM,MAAM,YAAY,GAAG,YAAY,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC;AAChE,MAAM,MAAM,YAAY,GAAG,YAAY,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC;AAC/D,MAAM,IAAI,CAAC,YAAY,EAAE;AACzB,QAAQ,OAAO,MAAM,CAAC;AACtB,OAAO;AACP,MAAM,IAAI,YAAY,EAAE;AACxB,QAAQ,MAAM,CAAC,OAAO,CAAC,cAAc,CAAC,GAAG,kBAAkB,CAAC;AAC5D,QAAQ,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC,CAAC;AACnE,OAAO,MAAM;AACb,QAAQ,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;AAC/C,OAAO;AACP,KAAK;AACL,IAAI,OAAO,MAAM,CAAC;AAClB,GAAG;AACH,EAAE,CAAC,KAAK,KAAK;AACb,IAAI,OAAO,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACjC,GAAG;AACH,CAAC,CAAC;AACF,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,GAAG;AAClC,EAAE,OAAO,QAAQ,KAAK;AACtB,IAAI,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE;AACjC,MAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC;AAC/B,MAAM,MAAM,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC;AAC9C,MAAM,OAAO,QAAQ,CAAC;AACtB,KAAK;AACL,IAAI,IAAI,QAAQ,CAAC,MAAM,KAAK,GAAG,EAAE,CAAC;AAClC,IAAI,OAAO,QAAQ,CAAC;AACpB,GAAG;AACH,EAAE,OAAO,KAAK,KAAK;AACnB,IAAI,IAAI,OAAO,MAAM,KAAK,WAAW,EAAE;AACvC,MAAM,IAAI,KAAK,CAAC,QAAQ,EAAE,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,QAAQ,EAAE,MAAM,KAAK,GAAG,EAAE;AAC5E,QAAQ,MAAM,cAAc,GAAG,MAAM,WAAW,EAAE,CAAC;AACnD,QAAQ,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;AACjC,QAAQ,IAAI,cAAc,EAAE;AAC5B,UAAU,YAAY,CAAC,OAAO,CAAC,aAAa,EAAE,cAAc,CAAC,CAAC;AAC9D,UAAU,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,GAAG,CAAC,OAAO,EAAE,cAAc,CAAC,CAAC,CAAC;AAC7E,UAAU,OAAO,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;AAC7C,SAAS;AACT,OAAO;AACP,KAAK;AACL,IAAI,OAAO,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACjC,GAAG;AACH,CAAC;;;;"}